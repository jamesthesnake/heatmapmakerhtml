<!DOCTYPE HTML>
<html>
<b>Fast  Heatmap Creator</b>
<br>
<a href="300k_by_8.csv" target="_blank">Sample Gene File Download</a>
<br>
<img src="morpheus.png" alt="matrix" style="width:304px;height:228px" align="middle";>
<br>
<br>
<style>
pre{
display:none;
}

.error {color: #FF0000;}
h1 {
    color: green;
}

.button {
    background-color: #4CAF50;
    border: none;
    color: red;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
}
h6{
    width: 300px;
    border: 25px solid green;
    padding: 25px;
    margin: 25px;
}
</style>

<head>

        <link rel="stylesheet" href="css/colorpicker.css" type="text/css" />
    <link rel="stylesheet" media="screen" type="text/css" href="css/layout.css" />
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/colorpicker.js"></script>
    <script type="text/javascript" src="js/eye.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/layout.js?ver=1.0.2"></script>
        <!-- Numeric.js -->
 <script src="    https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script> 
<!-- Plotly.js -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <!--<script src="plotly/loader/loadersrc/plotly-latest.min.js"></script>-->
        <!--<script src='libs/numeric.min.js'></script>=--> 
        </head>
        <body>

<script src="d3.min.js?v=3.2.8"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="jquery-csv.js"></script>






           

 <h4>1.46 choose your colors!</h4>
        <h3> <p id="demo"></p></h3>

	<h6>  <p>Step 1: Upload your heatmap file as csv </p>
<p>Step 2: Choose your high and low colors</p>
<p>Step 3: The heatmap is made automatically, you can zoom in, zoom out, and other functions provided in the heatmap palette</p>
 </h6>



        <script src="jscolor.js"></script>


       
       <h1><b>Low Color<b></h1>
         
<h5><button
   id="low"
  class="jscolor {valueElement:'chosen-value', onFineChange:'setTextColorTwo(this)'}">
     Pick first heatmap  color </button></h5>

        <h1><b>High Color<b></h1>

       <h2> <button class="jscolor {valueElement:'chosen-value', onFineChange:'setTextColor(this)'}">
   Pick second heatmap color
        </button></h2>

         <input type="hidden"  id="chosen-value" value="000000">

       <br>

	 <script>
        function setTextColor(picker) {
  document.getElementsByTagName('h5')[0].style.color = '#' + picker.toString();
}
     </script>

        
	<script>
        function setTextColorTwo(picker) {
  document.getElementsByTagName('h2')[0].style.color = '#' + picker.toString();

        }
        </script>

        

<script>
function setColors(){

    var x = document.createElement("INPUT");
    x.setAttribute("type", "color");
    document.body.appendChild(x);


}
</script>
        <!-- Plotly chart will be drawn inside this DIV -->



<div id="myDiv"></div>

<script type="text/javascript"charset="utf-8"> 
    var file   = document.getElementById("files").files[0];
                         
        d3.text(file, function(data) {                                
            var parsedCSV = d3.csv.parseRows(data);                         

            var container = d3.select("body")                               
                .append("table")                                            

                .selectAll("tr")                                            
                    .data(parsedCSV).enter()                                
                    .append("tr")                                           

              .selectAll("td")                                        
                    .data(function(d) { return d; }).enter()                
                    .append("td")                                           
                    .text(function(d) { return d; });                       
        });
</script>
<!--<button onclick="setColors()">Click me</button>-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<pre id="csv">
Device Name,Platform,OS Version,Portrait Width,Landscape Width,Release Date
Acer Iconia Tab A1-810,Android,4.2.2,768,1024,2013-05
Acer Iconia Tab A100,Android,4.0.3,800,1280,2011-04
Acer Iconia Tab A101,Android,3.2.1,600,1024,2011-05
Acer Iconia Tab A200,Android,4.0.3,800,1280,2012-01
Acer Iconia Tab A500,Android,4.0.3,648,1280,2011-04
Acer Iconia Tab A501,Android,3.2,800,1280,2011-04
ACER Liquid E2,Android,4.2.1,360,640,2013-05
</pre>
<script>
    var file   = document.getElementById("files").files[0];

var data = d3.csvParse(file);
console.log(data.columns);
</script>
<script>

function makeplot() {
  //Plotly.d3.csv("localhost", function(data){ processData(data) } );

};



var wait = true; 
var zValues = [];
function popData(fl) { 
Plotly.d3.csv(fl, function(data) {




  dataset = data.map(function(d) { return [ +d["Control 1"], +d["Control 2"], +d["Exp3"], +d["Exp4"], +d["Exp5"], +d["Exp6"] ]; });
     
  console.log(Object.getOwnPropertyNames(dataset)); 
    

 zValues = dataset; 
  console.log(zValues); 


  wait = false; 
}); 
}; 

  function handleFileSelect() {
    var file   = document.getElementById("files").files[0];
    var reader  = new FileReader();

  reader.addEventListener("load", function () {
    var fileURI = reader.result;
    popData(fileURI);
    console.log("fired");
    console.log(fileURI);




  }, false);

  if (file) {
    reader.readAsDataURL(file);



  }
     
  }
//popData(); 

function processData(allRows) {
  consolelog("hello")
  console.log(allRows);
  console.log(allRows[0]);
  zValues = allRows; 
  var x = [], y = [], standard_deviation = [];

  for (var i=0; i<allRows.length; i++) {
    row = allRows[i]; 
  }
  console.log( 'X',x, 'Y',y, 'SD',standard_deviation );
  makePlotly( x, y, standard_deviation );
}

makeplot(); 
//popData(); 

function setColor(){
				  
    var x = document.createElement("INPUT");
    x.setAttribute("type", "color");
    document.body.appendChild(x);
    

}
function getResult(){

     var names = document.getElementsByName("files[]");
   var data = d3.csvParse(names);
console.log(data.columns);  
console.log(names);


      if (!wait) {
                   var xValues = [' Team A', ' Team B',' Team C',' Team D',' Team E'];

var yValues = ['Team W', 'Team X', 'Team Y', 'Team Z'];

//console.log(zValues);

var age= document.getElementsByTagName('h5')[0].style.color;
var rude = document.getElementsByTagName('h2')[0].style.color;
var colorscaleValue = [
 
				  
  [0,age],
  [1,rude]
];

var data = [{
  x: xValues,
  y: yValues,
  z: zValues,
  type: 'heatmap',
  colorscale: colorscaleValue,
  showscale: false
}];

var layout = {
  title: 'High Performance Interactive Heatmap',
  annotations: [],
  xaxis: {
    ticks: '',
    side: 'top'
  },
  yaxis: {
    ticks: '',
    ticksuffix: ' ',
    width: 700,
    height: 700,
    autosize: false
  }
};

for ( var i = 0; i < yValues.length; i++ ) {
  for ( var j = 0; j < xValues.length; j++ ) {
    var currentValue = zValues[i][j];
    if (currentValue != 0.0) {
      var textColor = 'white';
    }else{
      var textColor = 'black';
    }
    var result = {
      xref: 'x1',
      yref: 'y1',
      x: xValues[j],
      y: yValues[i],
      text: zValues[i][j],
      font: {
        family: 'Arial',
        size: 12,
        color: 'rgb(50, 171, 96)'
      },
      showarrow: false,
      font: {
        color: textColor
      }
    };
    layout.annotations.push(result);
  }
}

Plotly.newPlot('myDiv', data, layout);
      } else {
           setTimeout(getResult, 250);
      }
 }

getResult(); 
        </script>

    </body>

<input type="file" id="files" name="files[]" onchange="handleFileSelect()" />
<output id="list"></output>

        </body>
</html>
